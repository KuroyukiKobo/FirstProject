# Git & GitHub 運用ガイド (FastAPI + React Project)

このドキュメントは、本プロジェクトにおけるGitとGitHubの基本的な運用ルールをまとめたものです。
チームメンバー全員が円滑に開発を進めるため、ご一読ください。

---

## 1. 基本的な考え方

* **バージョン管理**: コードの変更履歴を正確に記録し、いつでも過去の状態に戻せるようにします。
* **協調開発**: 複数の開発者が同時に作業しても、衝突を最小限に抑え、コードを統合できるようにします。
* **変更の透明性**: コミットメッセージを通じて、なぜその変更が行われたのか、何が変更されたのかを明確にします。

---

## 2. ブランチ戦略

本プロジェクトでは、シンプルな **GitHub Flow** またはそれに準ずるブランチ運用を採用します。
複雑な開発フロー（Git Flowなど）は避け、変更のリリースを迅速に行えるようにします。

### 2.1. 主要ブランチ

* **`main` ブランチ (または `master`)**:
    * **安定版**のコードを保持するブランチです。
    * **常にデプロイ可能な状態**であることを保証します。
    * 開発者はこのブランチに直接コミットしません。全ての変更はフィーチャーブランチからプルリクエスト（PR）経由でマージされます。

### 2.2. フィーチャーブランチ（開発用ブランチ）

* 新しい機能の実装、バグ修正、リファクタリングなど、**全ての開発作業はフィーチャーブランチで行います。**
* ブランチ名は、変更内容がわかるように簡潔に記述します。
    * 例: `feat/user-auth` (新機能: ユーザー認証)
    * 例: `fix/login-bug` (バグ修正: ログイン時の不具合)
    * 例: `refactor/api-structure` (リファクタリング: API構造の見直し)
    * 例: `chore/add-gitignore` (雑務: .gitignore追加)
* **ブランチ作成のタイミング**:
    * 新しいタスク（機能実装、バグ修正など）に取り掛かる直前に `main` ブランチから作成します。
    * 一つのフィーチャーブランチは、**一つの明確な目的**に集中させます。

### 2.3. ブランチの運用フロー

1.  **最新の `main` ブランチをフェッチし、同期する**:
    ```bash
    git switch main # または git checkout main (古いGitの場合)
    git pull origin main
    ```

2.  **フィーチャーブランチを作成し、切り替える**:
    ```bash
    git switch -c feat/your-feature-name # または git checkout -b feat/your-feature-name
    ```

3.  **開発作業を行い、コミットする**:
    * コードの変更、追加、削除を行います。
    * **コミットは頻繁に行い、論理的な変更単位でまとめます。**
    * コミットメッセージは、後述の「良いコミットメッセージの書き方」に従います。
    ```bash
    # 変更をステージング
    git add .
    # コミット
    git commit -m "feat: ユーザー登録機能の初回実装"
    ```

4.  **変更をリモートリポジトリにプッシュする**:
    ローカルのフィーチャーブランチの変更をリモートにアップロードします。
    ```bash
    git push -u origin feat/your-feature-name # 初回のみ -u オプション
    # 2回目以降は git push
    ```

5.  **プルリクエスト (Pull Request: PR) を作成する**:
    * 機能の実装が完了し、テストが済んだら、GitHub上で `feat/your-feature-name` から `main` ブランチへのプルリクエストを作成します。
    * PRのタイトルは、コミットメッセージの件名と同様に分かりやすく記述します。
    * PRの説明には、変更内容の概要、解決した課題、関連するイシュー、レビューしてほしい点などを詳しく記述します。
    * スクリーンショットや動画も積極的に添付しましょう。

6.  **コードレビューを受ける**:
    * チームメンバー（または自分自身）にPRをレビューしてもらい、フィードバックを反映します。
    * フィードバックに基づいて追加のコミットを行う場合は、同じフィーチャーブランチにコミットし、再度プッシュします。PRは自動的に更新されます。

7.  **マージする**:
    * レビューが承認され、CI/CDテスト（もしあれば）がパスしたら、PRを `main` ブランチにマージします。
    * **Squash and Merge** または **Rebase and Merge** を推奨します。（これはプロジェクトや個人の好みによるが、履歴をきれいに保つため）
        * **Squash and Merge**: PR内の複数のコミットを一つにまとめてマージします。`main`ブランチの履歴が簡潔になります。
        * **Rebase and Merge**: フィーチャーブランチのコミットを`main`ブランチの最新にリベースし、ファストフォワードでマージします。クリーンな履歴を保ちます。
    * マージ後、フィーチャーブランチは削除して構いません。

8.  **ローカルブランチのクリーンアップ**:
    マージが完了し、不要になったローカルのフィーチャーブランチは削除します。
    ```bash
    git switch main # mainブランチに切り替える
    git branch -d feat/your-feature-name # ローカルブランチを削除 (-D で強制削除)
    ```

---

## 3. 良いコミットメッセージの書き方

後から履歴を追う人が理解しやすい、明確で簡潔なコミットメッセージを心がけます。

* **件名 (一行目)**:
    * **50文字以内**で簡潔に、変更の**要約**を記述します。
    * **命令形**で記述します。（例: 「Add user login feature」ではなく「feat: Add user login feature」）
    * プレフィックス（[Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) のような）を付けると、変更の種類が視覚的に分かりやすくなります。
        * `feat`: 新機能の追加
        * `fix`: バグ修正
        * `docs`: ドキュメントの変更
        * `style`: コードの整形、セミコロンの追加など（ロジックに影響しない変更）
        * `refactor`: リファクタリング（機能変更を伴わないコードの再構築）
        * `perf`: パフォーマンス改善
        * `test`: テストの追加や修正
        * `chore`: ビルドツール、ライブラリの依存関係など、開発環境に関する変更（雑務）
        * `revert`: 過去のコミットの取り消し

* **本文 (二行目以降)**:
    * 件名と本文の間に**必ず空行を1行入れます。**
    * 変更の**背景**、**理由**、**解決した問題**、**設計の選択**などを詳しく記述します。
    * 関連する課題トラッカーのチケット番号やURLを記載すると良いでしょう。（例: `Closes #123`, `関連: Jira-XYZ-456`）

**良い例:**
feat: ユーザー登録機能のAPIエンドポイントを追加

新規ユーザー登録のためのPOST /users エンドポイントを実装した。
Pydanticモデルによるリクエストバリデーションと、仮のデータストアへの保存処理を含む。
パスワードのハッシュ化は未実装のため、今後のタスクとして考慮する。

解決する課題: #1 (ユーザー管理機能の基盤)

**悪い例:**
変更

色々追加した

---

## 4. コミットのタイミングと粒度

* **一つの論理的な変更単位でコミットします。**
    * バグ修正と新機能追加を一つのコミットに混ぜないようにします。
    * 例えば、「ユーザー登録フォームのUI追加」と「ユーザー登録APIの実装」は別々のコミットにするのが理想的です。
* **頻繁にコミットします。**
    * 動作が確認できた区切りでこまめにコミットすることで、問題発生時に原因特定が容易になります。
    * 誤操作からの復旧も容易になります。
* **途中の状態でもコミットしてOKです。**
    * `git stash`も一時的な作業退避には便利ですが、ブランチを切り替える前など、ある程度のまとまりがあればコミットしてしまいましょう。後で `git rebase -i` などで履歴を整理できます。

---

## 5. Gitコマンドチートシート

よく使うGitコマンドの早見表です。

* **リポジトリの初期化**:
    `git init`
* **変更状況の確認**:
    `git status`
* **変更のステージング**:
    `git add <file>` (特定のファイル)
    `git add .` (全ての変更)
* **コミット**:
    `git commit -m "コミットメッセージの件名"`
    `git commit` (エディタでメッセージを記述)
* **変更履歴の表示**:
    `git log`
    `git log --oneline --graph --all` (グラフ表示で分かりやすく)
* **ブランチの作成と切り替え**:
    `git branch <branch-name>` (作成のみ)
    `git switch <branch-name>` (切り替え)
    `git switch -c <branch-name>` (作成して切り替え)
* **ブランチの一覧表示**:
    `git branch` (ローカル)
    `git branch -a` (リモートも含む)
* **ブランチの削除**:
    `git branch -d <branch-name>` (マージ済みのブランチを安全に削除)
    `git branch -D <branch-name>` (強制削除)
    `git push origin --delete <branch-name>` (リモートブランチの削除)
* **リモートリポジトリとの同期**:
    `git pull origin <branch-name>` (リモートから変更を取得し、マージ)
    `git fetch origin` (リモートから変更を取得するが、マージしない)
    `git push origin <branch-name>` (ローカルの変更をリモートに反映)
* **変更の取り消し**:
    `git restore <file>` (ステージングされていない変更を元に戻す)
    `git restore --staged <file>` (ステージングされたファイルをUnstageする)
    `git revert <commit-hash>` (特定のコミットの変更を打ち消す新しいコミットを作成)
    `git reset --hard HEAD` (危険！コミットされていない全ての変更を破棄)
* **一時的な作業の退避**:
    `git stash push -m "一時退避のメッセージ"`
    `git stash list`
    `git stash pop`
    `git stash drop`

---

## 6. GitHubでのプルリクエスト (PR) 作成

1.  **フィーチャーブランチをプッシュ**: 開発作業が完了し、ローカルの変更をリモートにプッシュしたら、GitHubのウェブサイトにアクセスします。
2.  **PR作成の通知**: GitHubリポジトリのページに「Compare & pull request」ボタンが表示されるはずです。クリックしてPR作成画面へ進みます。
3.  **PRのタイトルと説明を記述**:
    * タイトルはコミットメッセージの件名と同様に分かりやすく。
    * 説明欄には、**「何のためのPRか」「どんな機能を追加/修正したか」「どうテストしたか」「注意点」**などを詳細に記述します。
    * 関連するイシューやタスクがあればリンクします（例: `#123`）。
4.  **レビュー担当者、ラベル、プロジェクトなどの設定**: 必要に応じて設定します。
5.  **PRの作成**: 作成ボタンをクリックします。
6.  **レビュー対応**: レビュー担当者からのコメントや変更要求に対応します。
7.  **マージ**: レビューが完了し、問題がなければ`main`ブランチへマージします。GitHubの推奨するマージオプション（Squash and Merge, Rebase and Merge）を利用すると良いでしょう。

